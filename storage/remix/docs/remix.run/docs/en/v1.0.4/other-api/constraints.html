<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/><link rel="icon" href="../../../../favicon-light.1.png" type="image/png" media="(prefers-color-scheme: light)"/><link rel="icon" href="../../../../favicon-dark.1.png" type="image/png" media="(prefers-color-scheme: dark)"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;family=Source+Code+Pro:wght@400;600&amp;display=auto" rel="stylesheet"/><title>Remix | Module Constraints</title><meta name="description"/><link rel="preload" as="font" href="../../../../font/founders-grotesk-bold.woff2" crossorigin="anonymous"/><link rel="stylesheet" href="../../../../build/_assets/tailwind-XN5LJQWA.css"/><link rel="stylesheet" href="../../../../build/_assets/bailwind-QVFUVIGW.css"/><link rel="stylesheet" href="../../../../build/_assets/docs-TIR56M2J.css"/></head><body x-comp="Body" class="min-h-screen flex flex-col w-full overflow-x-hidden bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-200 undefined"><div class="lg:flex lg:h-full px-6"><div class="lg:hidden"><div class="absolute top-6 right-6"><a href="../../v1.0.4.html"><svg x-comp="Wordmark" height="24" viewBox="0 0 659 165" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Remix Logo</title><path fill-rule="evenodd" clip-rule="evenodd" d="M133.85 124.16C135.3 142.762 135.3 151.482 135.3 161H92.2283C92.2283 158.927 92.2653 157.03 92.3028 155.107C92.4195 149.128 92.5411 142.894 91.5717 130.304C90.2905 111.872 82.3473 107.776 67.7419 107.776H54.8021H0V74.24H69.7918C88.2407 74.24 97.4651 68.632 97.4651 53.784C97.4651 40.728 88.2407 32.816 69.7918 32.816H0V0H77.4788C119.245 0 140 19.712 140 51.2C140 74.752 125.395 90.112 105.665 92.672C122.32 96 132.057 105.472 133.85 124.16Z" fill="currentColor"></path><path d="M0 161V136H45.5416C53.1486 136 54.8003 141.638 54.8003 145V161H0Z" fill="currentColor"></path><path d="M654.54 47.1035H611.788L592.332 74.2395L573.388 47.1035H527.564L568.78 103.168L523.98 161.28H566.732L589.516 130.304L612.3 161.28H658.124L613.068 101.376L654.54 47.1035Z" fill="url(#paint0_linear)"></path><path d="M654.54 47.1035H611.788L592.332 74.2395L573.388 47.1035H527.564L568.78 103.168L523.98 161.28H566.732L589.516 130.304L612.3 161.28H658.124L613.068 101.376L654.54 47.1035Z" fill="currentColor"></path><path d="M229.43 120.576C225.59 129.536 218.422 133.376 207.158 133.376C194.614 133.376 184.374 126.72 183.35 112.64H263.478V101.12C263.478 70.1437 243.254 44.0317 205.11 44.0317C169.526 44.0317 142.902 69.8877 142.902 105.984C142.902 142.336 169.014 164.352 205.622 164.352C235.83 164.352 256.822 149.76 262.71 123.648L229.43 120.576ZM183.862 92.6717C185.398 81.9197 191.286 73.7277 204.598 73.7277C216.886 73.7277 223.542 82.4317 224.054 92.6717H183.862Z" fill="url(#paint1_linear)"></path><path d="M229.43 120.576C225.59 129.536 218.422 133.376 207.158 133.376C194.614 133.376 184.374 126.72 183.35 112.64H263.478V101.12C263.478 70.1437 243.254 44.0317 205.11 44.0317C169.526 44.0317 142.902 69.8877 142.902 105.984C142.902 142.336 169.014 164.352 205.622 164.352C235.83 164.352 256.822 149.76 262.71 123.648L229.43 120.576ZM183.862 92.6717C185.398 81.9197 191.286 73.7277 204.598 73.7277C216.886 73.7277 223.542 82.4317 224.054 92.6717H183.862Z" fill="currentColor"></path><path d="M385.256 66.5597C380.392 53.2477 369.896 44.0317 349.672 44.0317C332.52 44.0317 320.232 51.7117 314.088 64.2557V47.1037H272.616V161.28H314.088V105.216C314.088 88.0638 318.952 76.7997 332.52 76.7997C345.064 76.7997 348.136 84.9917 348.136 100.608V161.28H389.608V105.216C389.608 88.0638 394.216 76.7997 408.04 76.7997C420.584 76.7997 423.4 84.9917 423.4 100.608V161.28H464.872V89.5997C464.872 65.7917 455.656 44.0317 424.168 44.0317C404.968 44.0317 391.4 53.7597 385.256 66.5597Z" fill="url(#paint2_linear)"></path><path d="M385.256 66.5597C380.392 53.2477 369.896 44.0317 349.672 44.0317C332.52 44.0317 320.232 51.7117 314.088 64.2557V47.1037H272.616V161.28H314.088V105.216C314.088 88.0638 318.952 76.7997 332.52 76.7997C345.064 76.7997 348.136 84.9917 348.136 100.608V161.28H389.608V105.216C389.608 88.0638 394.216 76.7997 408.04 76.7997C420.584 76.7997 423.4 84.9917 423.4 100.608V161.28H464.872V89.5997C464.872 65.7917 455.656 44.0317 424.168 44.0317C404.968 44.0317 391.4 53.7597 385.256 66.5597Z" fill="currentColor"></path><path d="M478.436 47.104V161.28H519.908V47.104H478.436ZM478.18 36.352H520.164V0H478.18V36.352Z" fill="url(#paint3_linear)"></path><path d="M478.436 47.104V161.28H519.908V47.104H478.436ZM478.18 36.352H520.164V0H478.18V36.352Z" fill="currentColor"></path><defs><linearGradient id="paint0_linear" x1="591.052" y1="47.1035" x2="591.052" y2="161.28" gradientUnits="userSpaceOnUse"><stop stop-color="currentColor"></stop><stop offset="1" stop-color="currentColor" stop-opacity="0"></stop></linearGradient><linearGradient id="paint1_linear" x1="203.19" y1="44.0317" x2="203.19" y2="164.352" gradientUnits="userSpaceOnUse"><stop stop-color="currentColor"></stop><stop offset="1" stop-color="currentColor" stop-opacity="0"></stop></linearGradient><linearGradient id="paint2_linear" x1="368.744" y1="44.0317" x2="368.744" y2="161.28" gradientUnits="userSpaceOnUse"><stop stop-color="currentColor"></stop><stop offset="1" stop-color="currentColor" stop-opacity="0"></stop></linearGradient><linearGradient id="paint3_linear" x1="499.172" y1="0" x2="499.172" y2="161.28" gradientUnits="userSpaceOnUse"><stop stop-color="currentColor"></stop><stop offset="1" stop-color="currentColor" stop-opacity="0"></stop></linearGradient></defs></svg></a></div><details><summary class="pb-4 pt-6 cursor-pointer">Docs Navigation</summary><div><nav class="md-nav py-6 text-d-p-sm font-medium"><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="1"><li data-dir="" data-level="1"><span class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading pt-0">Tutorials</span><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="2"><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../tutorials/blog.html">Developer Blog</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../tutorials/jokes.html">Jokes App</a></li></ul></li><li data-dir="" data-level="1"><span class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading">API</span><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="2"><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../api/conventions.html">Conventions</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../api/remix.html">Remix Package</a></li></ul></li><li data-dir="" data-level="1"><span class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading">Other API</span><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="2"><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="dev.html">@remix-run/dev (CLI)</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="adapter.html">@remix-run/{adapter}</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="node.html">@remix-run/node</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="serve.html">@remix-run/serve</a></li><li data-dir="" data-level="2"><a aria-current="page" class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2 md-nav-item--active" href="constraints.html">Module Constraints</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="react-router.html">React Router v6</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="fetch.html">Web Fetch API</a></li></ul></li><li data-dir="" data-level="1"><span class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading">Guides</span><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="2"><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/accessibility.html">Accessibility</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/api-routes.html">API Routes</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/data-writes.html">Data Writes</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/disabling-javascript.html">Disabling JavaScript</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/envvars.html">Environment Variables</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/errors.html">Error Handling</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/mdx.html">MDX</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/not-found.html">Not Found Handling</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/optimistic-ui.html">Optimistic UI</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/performance.html">Performance</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/philosophy.html">Philosophy</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/resource-routes.html">Resource Routes</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/routing.html">Routing</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/styling.html">Styling</a></li></ul></li><li data-dir="" data-level="1"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading" href="../contributing.html">Contributing</a></li></ul></nav></div></details><hr class="mb-4"/></div><div class="flex-shrink-0 hidden lg:block"><div class="h-full max-h-screen overflow-x-hidden overflow-y-auto w-64 xl:w-80 2xl:w-96 sticky top-0 py-10 pl-6 pr-3 xl:pr-5 2xl:pr-6"><a href="../../v1.0.4.html"><svg x-comp="Wordmark" height="24" viewBox="0 0 659 165" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Remix Logo</title><path fill-rule="evenodd" clip-rule="evenodd" d="M133.85 124.16C135.3 142.762 135.3 151.482 135.3 161H92.2283C92.2283 158.927 92.2653 157.03 92.3028 155.107C92.4195 149.128 92.5411 142.894 91.5717 130.304C90.2905 111.872 82.3473 107.776 67.7419 107.776H54.8021H0V74.24H69.7918C88.2407 74.24 97.4651 68.632 97.4651 53.784C97.4651 40.728 88.2407 32.816 69.7918 32.816H0V0H77.4788C119.245 0 140 19.712 140 51.2C140 74.752 125.395 90.112 105.665 92.672C122.32 96 132.057 105.472 133.85 124.16Z" fill="currentColor"></path><path d="M0 161V136H45.5416C53.1486 136 54.8003 141.638 54.8003 145V161H0Z" fill="currentColor"></path><path d="M654.54 47.1035H611.788L592.332 74.2395L573.388 47.1035H527.564L568.78 103.168L523.98 161.28H566.732L589.516 130.304L612.3 161.28H658.124L613.068 101.376L654.54 47.1035Z" fill="url(#paint0_linear)"></path><path d="M654.54 47.1035H611.788L592.332 74.2395L573.388 47.1035H527.564L568.78 103.168L523.98 161.28H566.732L589.516 130.304L612.3 161.28H658.124L613.068 101.376L654.54 47.1035Z" fill="currentColor"></path><path d="M229.43 120.576C225.59 129.536 218.422 133.376 207.158 133.376C194.614 133.376 184.374 126.72 183.35 112.64H263.478V101.12C263.478 70.1437 243.254 44.0317 205.11 44.0317C169.526 44.0317 142.902 69.8877 142.902 105.984C142.902 142.336 169.014 164.352 205.622 164.352C235.83 164.352 256.822 149.76 262.71 123.648L229.43 120.576ZM183.862 92.6717C185.398 81.9197 191.286 73.7277 204.598 73.7277C216.886 73.7277 223.542 82.4317 224.054 92.6717H183.862Z" fill="url(#paint1_linear)"></path><path d="M229.43 120.576C225.59 129.536 218.422 133.376 207.158 133.376C194.614 133.376 184.374 126.72 183.35 112.64H263.478V101.12C263.478 70.1437 243.254 44.0317 205.11 44.0317C169.526 44.0317 142.902 69.8877 142.902 105.984C142.902 142.336 169.014 164.352 205.622 164.352C235.83 164.352 256.822 149.76 262.71 123.648L229.43 120.576ZM183.862 92.6717C185.398 81.9197 191.286 73.7277 204.598 73.7277C216.886 73.7277 223.542 82.4317 224.054 92.6717H183.862Z" fill="currentColor"></path><path d="M385.256 66.5597C380.392 53.2477 369.896 44.0317 349.672 44.0317C332.52 44.0317 320.232 51.7117 314.088 64.2557V47.1037H272.616V161.28H314.088V105.216C314.088 88.0638 318.952 76.7997 332.52 76.7997C345.064 76.7997 348.136 84.9917 348.136 100.608V161.28H389.608V105.216C389.608 88.0638 394.216 76.7997 408.04 76.7997C420.584 76.7997 423.4 84.9917 423.4 100.608V161.28H464.872V89.5997C464.872 65.7917 455.656 44.0317 424.168 44.0317C404.968 44.0317 391.4 53.7597 385.256 66.5597Z" fill="url(#paint2_linear)"></path><path d="M385.256 66.5597C380.392 53.2477 369.896 44.0317 349.672 44.0317C332.52 44.0317 320.232 51.7117 314.088 64.2557V47.1037H272.616V161.28H314.088V105.216C314.088 88.0638 318.952 76.7997 332.52 76.7997C345.064 76.7997 348.136 84.9917 348.136 100.608V161.28H389.608V105.216C389.608 88.0638 394.216 76.7997 408.04 76.7997C420.584 76.7997 423.4 84.9917 423.4 100.608V161.28H464.872V89.5997C464.872 65.7917 455.656 44.0317 424.168 44.0317C404.968 44.0317 391.4 53.7597 385.256 66.5597Z" fill="currentColor"></path><path d="M478.436 47.104V161.28H519.908V47.104H478.436ZM478.18 36.352H520.164V0H478.18V36.352Z" fill="url(#paint3_linear)"></path><path d="M478.436 47.104V161.28H519.908V47.104H478.436ZM478.18 36.352H520.164V0H478.18V36.352Z" fill="currentColor"></path><defs><linearGradient id="paint0_linear" x1="591.052" y1="47.1035" x2="591.052" y2="161.28" gradientUnits="userSpaceOnUse"><stop stop-color="currentColor"></stop><stop offset="1" stop-color="currentColor" stop-opacity="0"></stop></linearGradient><linearGradient id="paint1_linear" x1="203.19" y1="44.0317" x2="203.19" y2="164.352" gradientUnits="userSpaceOnUse"><stop stop-color="currentColor"></stop><stop offset="1" stop-color="currentColor" stop-opacity="0"></stop></linearGradient><linearGradient id="paint2_linear" x1="368.744" y1="44.0317" x2="368.744" y2="161.28" gradientUnits="userSpaceOnUse"><stop stop-color="currentColor"></stop><stop offset="1" stop-color="currentColor" stop-opacity="0"></stop></linearGradient><linearGradient id="paint3_linear" x1="499.172" y1="0" x2="499.172" y2="161.28" gradientUnits="userSpaceOnUse"><stop stop-color="currentColor"></stop><stop offset="1" stop-color="currentColor" stop-opacity="0"></stop></linearGradient></defs></svg></a><div class="h-8"></div><nav class="md-nav"><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="1"><li data-dir="" data-level="1"><span class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading pt-0">Tutorials</span><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="2"><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../tutorials/blog.html">Developer Blog</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../tutorials/jokes.html">Jokes App</a></li></ul></li><li data-dir="" data-level="1"><span class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading">API</span><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="2"><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../api/conventions.html">Conventions</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../api/remix.html">Remix Package</a></li></ul></li><li data-dir="" data-level="1"><span class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading">Other API</span><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="2"><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="dev.html">@remix-run/dev (CLI)</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="adapter.html">@remix-run/{adapter}</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="node.html">@remix-run/node</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="serve.html">@remix-run/serve</a></li><li data-dir="" data-level="2"><a aria-current="page" class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2 md-nav-item--active" href="constraints.html">Module Constraints</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="react-router.html">React Router v6</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="fetch.html">Web Fetch API</a></li></ul></li><li data-dir="" data-level="1"><span class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading">Guides</span><ul class="md-nav-list text-[color:var(--hue-0750)] mb-3" data-level="2"><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/accessibility.html">Accessibility</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/api-routes.html">API Routes</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/data-writes.html">Data Writes</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/disabling-javascript.html">Disabling JavaScript</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/envvars.html">Environment Variables</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/errors.html">Error Handling</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/mdx.html">MDX</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/not-found.html">Not Found Handling</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/optimistic-ui.html">Optimistic UI</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/performance.html">Performance</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/philosophy.html">Philosophy</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/resource-routes.html">Resource Routes</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/routing.html">Routing</a></li><li data-dir="" data-level="2"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-2" href="../guides/styling.html">Styling</a></li></ul></li><li data-dir="" data-level="1"><a class="md-nav-item py-1 block text-m-p-sm lg:text-sm md-nav-item--level-1 md-nav-heading" href="../contributing.html">Contributing</a></li></ul></nav></div></div><div class="lg:z-[1] flex-grow lg:h-full"><div class="py-6 md:py-8 lg:py-10 lg:pr-6 lg:pl-3 xl:pl-5 2xl:pl-6"><div><div class="markdown has-toc"><div class="md-toc-container"><div class="md-toc-nav" role="navigation"><ul class="toc">
<li>
<p><a href="constraints.html#module-constraints">Module Constraints</a></p>
<ul>
<li>
<p><a href="constraints.html#server-code-pruning">Server Code Pruning</a></p>
<ul>
<li><a href="constraints.html#no-module-side-effects">No Module Side Effects</a></li>
<li><a href="constraints.html#higher-order-functions">Higher Order Functions</a></li>
</ul>
</li>
<li>
<p><a href="constraints.html#browser-only-code-on-the-server">Browser-Only Code on the Server</a></p>
<ul>
<li>
<p><a href="constraints.html#initializing-browser-only-apis">Initializing Browser Only APIs</a></p>
<ul>
<li><a href="constraints.html#window-guard">Window Guard</a></li>
<li><a href="constraints.html#lazy-initialization">Lazy Initialization</a></li>
</ul>
</li>
<li>
<p><a href="constraints.html#rendering-with-browser-only-apis">Rendering with Browser Only APIs</a></p>
</li>
<li>
<p><a href="constraints.html#uselayouteffect"><code>useLayoutEffect</code></a></p>
</li>
<li>
<p><a href="constraints.html#third-party-module-side-effects">Third-Party Module Side Effects</a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul></div><div class="md-prose"><h1 id="module-constraints"><a href="constraints.html#module-constraints" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Module Constraints</h1><p>In order for Remix to run your app in both the server and browser environments, your application modules and third party dependencies need to be careful about <strong>module side effects</strong>.</p><ul>
<li><strong>Server-only code</strong> - Remix will remove server-only code but it can't if you have module side effects that use server-only code.</li>
<li><strong>Browser-only code</strong> - Remix renders on the server so your modules can't have module side effects or first-rendering logic that call browser-only APIs</li>
</ul><h2 id="server-code-pruning"><a href="constraints.html#server-code-pruning" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Server Code Pruning</h2><p>The Remix compiler will automatically remove server code from the browser bundles. Our strategy is actually pretty straightforward, but requires you to follow some rules.</p><ol>
<li>It creates a "proxy" module in front of your route module</li>
<li>The proxy module only imports the browser specific exports</li>
</ol><p>Consider a route module that exports <code>loader</code>, <code>meta</code>, and a component:</p><div><pre data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";
</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">prisma</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../db</span>";
</span><span class="codeblock-line" data-line-number="4">
</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">loader</span>() {
</span><span class="codeblock-line" data-line-number="6">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">prisma</span>.<span style="color: var(--base0D)">post</span>.<span style="color: var(--base0D)">findMany</span>();
</span><span class="codeblock-line" data-line-number="7">}
</span><span class="codeblock-line" data-line-number="8">
</span><span class="codeblock-line" data-line-number="9"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {
</span><span class="codeblock-line" data-line-number="10">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };
</span><span class="codeblock-line" data-line-number="11">}
</span><span class="codeblock-line" data-line-number="12">
</span><span class="codeblock-line" data-line-number="13"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {
</span><span class="codeblock-line" data-line-number="14">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();
</span><span class="codeblock-line" data-line-number="15">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;
</span><span class="codeblock-line" data-line-number="16">}
</span></code></pre></div><p>The server needs everything in this file but the browser only needs the component and <code>meta</code>. In fact, it'll be completely broken if it includes the <code>prisma</code> module in the browser bundle. That thing is full of node-only APIs!</p><p>To remove the server code from the browser bundles, the Remix compiler creates a proxy module in front of your route and bundles that instead. The proxy for this route would look like:</p><div><pre data-line-numbers="true" data-lang="ts" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">export</span> { <span style="color: var(--base08)">meta</span>, <span style="color: var(--base0E)">default</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">./routes/posts.tsx</span>";
</span></code></pre></div><p>The compiler will now analyze the code in <code>routes/posts.tsx</code> and only keep code that's inside of <code>meta</code> and the component. The result is something like this:</p><div><pre data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";
</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";
</span><span class="codeblock-line" data-line-number="3">
</span><span class="codeblock-line" data-line-number="4"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {
</span><span class="codeblock-line" data-line-number="5">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };
</span><span class="codeblock-line" data-line-number="6">}
</span><span class="codeblock-line" data-line-number="7">
</span><span class="codeblock-line" data-line-number="8"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {
</span><span class="codeblock-line" data-line-number="9">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();
</span><span class="codeblock-line" data-line-number="10">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;
</span><span class="codeblock-line" data-line-number="11">}
</span></code></pre></div><p>Pretty slick! This is now safe to bundle up for the browser. So what's the problem?</p><h3 id="no-module-side-effects"><a href="constraints.html#no-module-side-effects" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>No Module Side Effects</h3><p>If you're unfamiliar with side effects, you're not alone! We'll help you identify them now.</p><p>Simply put, a <strong>side effect</strong> is any code that might <em>do something</em>. A <strong>module side effect</strong> is any code that might <em>do something when a module is loaded</em>.</p><p><docs-info>A module side effect is code that executes by simply importing a module</docs-info></p><p>Taking our code from earlier, we saw how the compiler can remove the exports and their imports that aren't used. But if we add this seemingly harmless line of code your app will break!</p><div><pre data-bad="" data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";
</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">prisma</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../db</span>";
</span><span class="codeblock-line" data-line-number="4">
</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base08)">console</span>.<span style="color: var(--base0D)">log</span>(<span style="color: var(--base08)">prisma</span>);
</span><span class="codeblock-line" data-line-number="6">
</span><span class="codeblock-line" data-line-number="7"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">loader</span>() {
</span><span class="codeblock-line" data-line-number="8">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">prisma</span>.<span style="color: var(--base0D)">post</span>.<span style="color: var(--base0D)">findMany</span>();
</span><span class="codeblock-line" data-line-number="9">}
</span><span class="codeblock-line" data-line-number="10">
</span><span class="codeblock-line" data-line-number="11"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {
</span><span class="codeblock-line" data-line-number="12">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };
</span><span class="codeblock-line" data-line-number="13">}
</span><span class="codeblock-line" data-line-number="14">
</span><span class="codeblock-line" data-line-number="15"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {
</span><span class="codeblock-line" data-line-number="16">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();
</span><span class="codeblock-line" data-line-number="17">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;
</span><span class="codeblock-line" data-line-number="18">}
</span></code></pre></div><p>That <code>console.log</code> <em>does something</em>. The module is imported and then immediately logs to the console. The compiler won't remove it because it has to run when the module is imported. It will bundle something like this:</p><div><pre data-bad="" data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";
</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">prisma</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../db</span>"; <span style="color: var(--base03)">//ðŸ˜¬</span>
</span><span class="codeblock-line" data-line-number="4">
</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base08)">console</span>.<span style="color: var(--base0D)">log</span>(<span style="color: var(--base08)">prisma</span>); <span style="color: var(--base03)">//ðŸ¥¶</span>
</span><span class="codeblock-line" data-line-number="6">
</span><span class="codeblock-line" data-line-number="7"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {
</span><span class="codeblock-line" data-line-number="8">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };
</span><span class="codeblock-line" data-line-number="9">}
</span><span class="codeblock-line" data-line-number="10">
</span><span class="codeblock-line" data-line-number="11"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {
</span><span class="codeblock-line" data-line-number="12">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();
</span><span class="codeblock-line" data-line-number="13">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;
</span><span class="codeblock-line" data-line-number="14">}
</span></code></pre></div><p>The loader is gone but the prisma dependency stayed! Had we logged something harmless like <code>console.log("hello!")</code> it would be fine. But we logged the <code>prisma</code> module so the browser's gonna have a hard time with that.</p><p>To fix this, remove the side effect by simply moving the code <em>into the loader</em>.</p><div><pre data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";
</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">prisma</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../db</span>";
</span><span class="codeblock-line" data-line-number="4">
</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">loader</span>() {
</span><span class="codeblock-line" data-highlight="true" data-line-number="6">  <span style="color: var(--base08)">console</span>.<span style="color: var(--base0D)">log</span>(<span style="color: var(--base08)">prisma</span>);
</span><span class="codeblock-line" data-line-number="7">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">prisma</span>.<span style="color: var(--base0D)">post</span>.<span style="color: var(--base0D)">findMany</span>();
</span><span class="codeblock-line" data-line-number="8">}
</span><span class="codeblock-line" data-line-number="9">
</span><span class="codeblock-line" data-line-number="10"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {
</span><span class="codeblock-line" data-line-number="11">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };
</span><span class="codeblock-line" data-line-number="12">}
</span><span class="codeblock-line" data-line-number="13">
</span><span class="codeblock-line" data-line-number="14"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {
</span><span class="codeblock-line" data-line-number="15">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();
</span><span class="codeblock-line" data-line-number="16">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;
</span><span class="codeblock-line" data-line-number="17">}
</span></code></pre></div><p>This is no longer a module side effect (runs when the module is imported), but rather a side effect of the loader (runs when the loader is called). The compiler will now remove both the loader <em>and the prisma import</em> because it isn't used anywhere else in the module.</p><h3 id="higher-order-functions"><a href="constraints.html#higher-order-functions" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Higher Order Functions</h3><p>Some Remix newcomers try to abstract their loaders with "higher order functions". Something like this:</p><div><pre data-bad="" data-filename="app/http.js" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">redirect</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";
</span><span class="codeblock-line" data-line-number="2">
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">loader</span>) {
</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">function</span> (<span style="color: var(--base08)">arg</span>) {
</span><span class="codeblock-line" data-line-number="5">    <span style="color: var(--base0A)">let</span> { <span style="color: var(--base08)">request</span> } <span style="color: var(--base0E)">=</span> <span style="color: var(--base08)">arg</span>;
</span><span class="codeblock-line" data-line-number="6">    <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">url</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">new</span> <span style="color: var(--base0D)">URL</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base08)">url</span>);
</span><span class="codeblock-line" data-line-number="7">    <span style="color: var(--base0E)">if</span> (<span style="color: var(--base08)">url</span>.<span style="color: var(--base0D)">pathname</span>.<span style="color: var(--base0D)">endsWith</span>("<span style="color: var(--base0B)">/</span>")) {
</span><span class="codeblock-line" data-line-number="8">      <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">redirect</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base0D)">url</span>.<span style="color: var(--base0D)">slice</span>(<span style="color: var(--base09)">0</span>, <span style="color: var(--base0E)">-</span><span style="color: var(--base09)">1</span>), {
</span><span class="codeblock-line" data-line-number="9">        status: <span style="color: var(--base09)">308</span>
</span><span class="codeblock-line" data-line-number="10">      });
</span><span class="codeblock-line" data-line-number="11">    }
</span><span class="codeblock-line" data-line-number="12">    <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">loader</span>(<span style="color: var(--base08)">arg</span>);
</span><span class="codeblock-line" data-line-number="13">  };
</span><span class="codeblock-line" data-line-number="14">}
</span></code></pre></div><p>And then try to use it like this:</p><div><pre data-bad="" data-filename="app/root.js" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">removeTrailingSlash</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">~/http</span>";
</span><span class="codeblock-line" data-line-number="2">
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">loader</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">removeTrailingSlash</span>(({ <span style="color: var(--base08)">request</span> }) <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base0E)">return</span> { some: "<span style="color: var(--base0B)">data</span>" };
</span><span class="codeblock-line" data-line-number="5">});
</span></code></pre></div><p>You can probably now see that this is a module side effect so the compiler can't prune out the <code>removeTrailingSlash</code> code.</p><p>This type of abstraction is introduced to try to return a response early. Since you can throw a Response in a loader, we can make this simpler and remove the module side effect at the same time so that the server code can be pruned:</p><div><pre data-filename="app/http.js" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">redirect</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";
</span><span class="codeblock-line" data-line-number="2">
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">url</span>) {
</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base0E)">if</span> (<span style="color: var(--base08)">url</span>.<span style="color: var(--base0D)">pathname</span>.<span style="color: var(--base0D)">endsWith</span>("<span style="color: var(--base0B)">/</span>")) {
</span><span class="codeblock-line" data-line-number="5">    <span style="color: var(--base0E)">throw</span> <span style="color: var(--base0D)">redirect</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base0D)">url</span>.<span style="color: var(--base0D)">slice</span>(<span style="color: var(--base09)">0</span>, <span style="color: var(--base0E)">-</span><span style="color: var(--base09)">1</span>), {
</span><span class="codeblock-line" data-line-number="6">      status: <span style="color: var(--base09)">308</span>
</span><span class="codeblock-line" data-line-number="7">    });
</span><span class="codeblock-line" data-line-number="8">  }
</span><span class="codeblock-line" data-line-number="9">}
</span></code></pre></div><p>And then use it like this:</p><div><pre data-bad="" data-filename="app/root.js" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">removeTrailingSlash</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">~/http</span>";
</span><span class="codeblock-line" data-line-number="2">
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0A)">let</span> <span style="color: var(--base0D)">loader</span> <span style="color: var(--base0E)">=</span> ({ <span style="color: var(--base08)">request</span> }) <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base08)">url</span>);
</span><span class="codeblock-line" data-line-number="5">  <span style="color: var(--base0E)">return</span> { some: "<span style="color: var(--base0B)">data</span>" };
</span><span class="codeblock-line" data-line-number="6">};
</span></code></pre></div><p>It reads much nicer as well when you've got a lot of these:</p><div><pre data-line-numbers="true" data-lang="ts" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base03)">// this</span>
</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">let</span> <span style="color: var(--base0D)">loader</span> <span style="color: var(--base0E)">=</span> ({ <span style="color: var(--base08)">request</span> }) <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-line-number="3">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base08)">url</span>, () <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-line-number="4">    <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">withSession</span>(<span style="color: var(--base08)">request</span>, <span style="color: var(--base08)">session</span> <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-line-number="5">      <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">requireUser</span>(<span style="color: var(--base08)">session</span>, <span style="color: var(--base08)">user</span> <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-line-number="6">        <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">json</span>(<span style="color: var(--base08)">user</span>);
</span><span class="codeblock-line" data-line-number="7">      });
</span><span class="codeblock-line" data-line-number="8">    });
</span><span class="codeblock-line" data-line-number="9">  });
</span><span class="codeblock-line" data-line-number="10">};
</span><span class="codeblock-line" data-line-number="11">
</span><span class="codeblock-line" data-line-number="12"><span style="color: var(--base03)">// vs. this</span>
</span><span class="codeblock-line" data-line-number="13"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">let</span> <span style="color: var(--base0D)">loader</span> <span style="color: var(--base0E)">=</span> ({ <span style="color: var(--base08)">request</span> }) <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-line-number="14">  <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base08)">url</span>);
</span><span class="codeblock-line" data-line-number="15">  <span style="color: var(--base0E)">let</span> <span style="color: var(--base08)">session</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">getSession</span>(<span style="color: var(--base08)">request</span>);
</span><span class="codeblock-line" data-line-number="16">  <span style="color: var(--base0E)">let</span> <span style="color: var(--base08)">user</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">requireUser</span>(<span style="color: var(--base08)">session</span>);
</span><span class="codeblock-line" data-line-number="17">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">json</span>(<span style="color: var(--base08)">user</span>);
</span><span class="codeblock-line" data-line-number="18">};
</span></code></pre></div><p>If you want to do some extra-curricular reading, google around for "push vs. pull API". The ability to throw responses changes the model from a "push" to a "pull". This is the same reason folks prefer async/await over callbacks, and React hooks over higher order components and render props.</p><h2 id="browser-only-code-on-the-server"><a href="constraints.html#browser-only-code-on-the-server" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Browser-Only Code on the Server</h2><p>Unlike the browser bundles, Remix doesn't try to remove <em>browser only code</em> from the server bundle because the route modules require every export to render on the server. This means it's your job to be mindful of code that should only execute in the browser.</p><p><docs-error>This will break your app:</docs-error></p><div><pre data-bad="" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">loadStripe</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">@stripe/stripe-js</span>";
</span><span class="codeblock-line" data-line-number="2">
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">stripe</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">loadStripe</span>(<span style="color: var(--base08)">window</span>.<span style="color: var(--base08)">ENV</span>.<span style="color: var(--base08)">stripe</span>);
</span><span class="codeblock-line" data-line-number="4">
</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">async</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">redirectToStripeCheckout</span>(<span style="color: var(--base08)">sessionId</span>) {
</span><span class="codeblock-line" data-line-number="6">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">stripe</span>.<span style="color: var(--base0D)">redirectToCheckout</span>({ <span style="color: var(--base08)">sessionId</span> });
</span><span class="codeblock-line" data-line-number="7">}
</span></code></pre></div><p><docs-info>You need to avoid any browser-only module side effects like accessing window or initializing APIs in the module scope.</docs-info></p><h3 id="initializing-browser-only-apis"><a href="constraints.html#initializing-browser-only-apis" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Initializing Browser Only APIs</h3><p>The most common scenario is intitializing a third party API when your module is imported. There are a couple ways to easily deal with this.</p><h4 id="window-guard"><a href="constraints.html#window-guard" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Window Guard</h4><p>This ensures the library is only initialized if there is a <code>window</code>, meaning you're in the browser.</p><div><pre data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">firebase</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">firebase/app</span>";
</span><span class="codeblock-line" data-line-number="2">
</span><span class="codeblock-line" data-highlight="true" data-line-number="3"><span style="color: var(--base0E)">if</span> (<span style="color: var(--base0E)">typeof</span> <span style="color: var(--base08)">window</span> <span style="color: var(--base0E)">!==</span> "<span style="color: var(--base0B)">undefined</span>") {
</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base08)">firebase</span>.<span style="color: var(--base0D)">initializeApp</span>(<span style="color: var(--base08)">window</span>.<span style="color: var(--base08)">ENV</span>.<span style="color: var(--base08)">firebase</span>);
</span><span class="codeblock-line" data-line-number="5">}
</span><span class="codeblock-line" data-line-number="6">
</span><span class="codeblock-line" data-line-number="7"><span style="color: var(--base0E)">export</span> { <span style="color: var(--base08)">firebase</span> };
</span></code></pre></div><h4 id="lazy-initialization"><a href="constraints.html#lazy-initialization" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Lazy Initialization</h4><p>This strategy defers initialization until the library is actually used:</p><div><pre data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">loadStripe</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">@stripe/stripe-js</span>";
</span><span class="codeblock-line" data-line-number="2">
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">async</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">redirectToStripeCheckout</span>(<span style="color: var(--base08)">sessionId</span>) {
</span><span class="codeblock-line" data-highlight="true" data-line-number="4">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">stripe</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">loadStripe</span>(<span style="color: var(--base08)">window</span>.<span style="color: var(--base08)">ENV</span>.<span style="color: var(--base08)">stripe</span>);
</span><span class="codeblock-line" data-line-number="5">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">stripe</span>.<span style="color: var(--base0D)">redirectToCheckout</span>({ <span style="color: var(--base08)">sessionId</span> });
</span><span class="codeblock-line" data-line-number="6">}
</span></code></pre></div><p>You may want to avoid initializing the library multiple times by storing it in a module-scoped variable.</p><div><pre data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">loadStripe</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">@stripe/stripe-js</span>";
</span><span class="codeblock-line" data-line-number="2">
</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">_stripe</span>;
</span><span class="codeblock-line" data-line-number="4"><span style="color: var(--base0E)">async</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">getStripe</span>() {
</span><span class="codeblock-line" data-line-number="5">  <span style="color: var(--base0E)">if</span> (<span style="color: var(--base0E)">!</span><span style="color: var(--base08)">_stripe</span>) {
</span><span class="codeblock-line" data-line-number="6">    <span style="color: var(--base08)">_stripe</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">loadStripe</span>(<span style="color: var(--base08)">window</span>.<span style="color: var(--base08)">ENV</span>.<span style="color: var(--base08)">stripe</span>);
</span><span class="codeblock-line" data-line-number="7">  }
</span><span class="codeblock-line" data-line-number="8">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">_stripe</span>;
</span><span class="codeblock-line" data-line-number="9">}
</span><span class="codeblock-line" data-line-number="10">
</span><span class="codeblock-line" data-line-number="11"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">async</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">redirectToStripeCheckout</span>(<span style="color: var(--base08)">sessionId</span>) {
</span><span class="codeblock-line" data-line-number="12">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">stripe</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">getStripe</span>();
</span><span class="codeblock-line" data-line-number="13">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">stripe</span>.<span style="color: var(--base0D)">redirectToCheckout</span>({ <span style="color: var(--base08)">sessionId</span> });
</span><span class="codeblock-line" data-line-number="14">}
</span></code></pre></div><p><docs-info>While none of these strategies remove browser modules from the server bundle, it's okay because the APIs are only called inside of event handlers and effects, which are not module side effects.</docs-info></p><h3 id="rendering-with-browser-only-apis"><a href="constraints.html#rendering-with-browser-only-apis" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Rendering with Browser Only APIs</h3><p>Another common case is code that calls browser-only APIs while rendering. When server rendering in React (not just Remix), this must be avoided because the APIs don't exist on the server.</p><p><docs-error>This will break your app because the server will try to use local storage</docs-error></p><div><pre data-bad="" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">useLocalStorage</span>(<span style="color: var(--base08)">key</span>) {
</span><span class="codeblock-line" data-line-number="2">  <span style="color: var(--base0A)">let</span> [<span style="color: var(--base08)">state</span>, <span style="color: var(--base08)">setState</span>] <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useState</span>(
</span><span class="codeblock-line" data-line-number="3">    <span style="color: var(--base08)">localStorage</span>.<span style="color: var(--base0D)">getItem</span>(<span style="color: var(--base08)">key</span>)
</span><span class="codeblock-line" data-line-number="4">  );
</span><span class="codeblock-line" data-line-number="5">
</span><span class="codeblock-line" data-line-number="6">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base0D)">setWithLocalStorage</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base08)">nextState</span> <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-line-number="7">    <span style="color: var(--base0D)">setState</span>(<span style="color: var(--base08)">nextState</span>);
</span><span class="codeblock-line" data-line-number="8">  };
</span><span class="codeblock-line" data-line-number="9">
</span><span class="codeblock-line" data-line-number="10">  <span style="color: var(--base0E)">return</span> [<span style="color: var(--base08)">state</span>, <span style="color: var(--base08)">setWithLocalStorage</span>];
</span><span class="codeblock-line" data-line-number="11">}
</span></code></pre></div><p>You can fix this by moving the code into <code>useEffect</code>, which only runs in the browser.</p><div><pre data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">useLocalStorage</span>(<span style="color: var(--base08)">key</span>) {
</span><span class="codeblock-line" data-highlight="true" data-line-number="2">  <span style="color: var(--base0A)">let</span> [<span style="color: var(--base08)">state</span>, <span style="color: var(--base08)">setState</span>] <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useState</span>(<span style="color: var(--base09)">null</span>);
</span><span class="codeblock-line" data-line-number="3">
</span><span class="codeblock-line" data-highlight="true" data-line-number="4">  <span style="color: var(--base0D)">useEffect</span>(() <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-highlight="true" data-line-number="5">    <span style="color: var(--base0D)">setState</span>(<span style="color: var(--base08)">localStorage</span>.<span style="color: var(--base0D)">getItem</span>(<span style="color: var(--base08)">key</span>));
</span><span class="codeblock-line" data-highlight="true" data-line-number="6">  }, []);
</span><span class="codeblock-line" data-line-number="7">
</span><span class="codeblock-line" data-line-number="8">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base0D)">setWithLocalStorage</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base08)">nextState</span> <span style="color: var(--base0D)">=></span> {
</span><span class="codeblock-line" data-line-number="9">    <span style="color: var(--base0D)">setState</span>(<span style="color: var(--base08)">nextState</span>);
</span><span class="codeblock-line" data-line-number="10">  };
</span><span class="codeblock-line" data-line-number="11">
</span><span class="codeblock-line" data-line-number="12">  <span style="color: var(--base0E)">return</span> [<span style="color: var(--base08)">state</span>, <span style="color: var(--base08)">setWithLocalStorage</span>];
</span><span class="codeblock-line" data-line-number="13">}
</span></code></pre></div><p>Now <code>localStorage</code> is not being accessed on the initial render, which will work for the server. In the browser, that state will fill in immediately after hydration. Hopefully it doesn't cause a big content layout shift though! If it does, maybe move that state into your database or a cookie so you can access it server side.</p><h3 id="uselayouteffect"><a href="constraints.html#uselayouteffect" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>useLayoutEffect</code></h3><p>If you use this hook React will warn you about using it on the server.</p><p>This hook is great when you're setting state for things like:</p><ul>
<li>The position of an element when it pops up (like a menu button)</li>
<li>The scroll position in response to user interactions</li>
</ul><p>The point is to perform the effect at the same time as the browser paint so that you don't see the popup show up at <code>0,0</code> and then bounce into place. Layout effects let the paint and the effect happen at the same time to avoid this kind of flashing.</p><p>It is <strong>not</strong> good for setting state that is rendered inside of elements. Just make sure you aren't using the state set in a <code>useLayoutEffect</code> in your elements and you can ignore React's warning.</p><p>TODO: Link to Reach UI <code>useIsomorphicLayoutEffect</code></p><h3 id="third-party-module-side-effects"><a href="constraints.html#third-party-module-side-effects" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Third-Party Module Side Effects</h3><p>Some third party libraries have their own module side effects that are incompatible with React server rendering. Usually it's trying to access <code>window</code> for feature detection.</p><p>These libraries are incompatible with server rendering in React and therefore incompatible with Remix. Fortunately, very few third party libraries in the React ecosystem do this.</p><p>We recommend finding an alternative. But if you can't, we recommend using <a href="https://www.npmjs.com/package/patch-package">patch-package</a> to fix it up in your app.</p></div></div>
</div><div class="h-[90vh]"></div></div></div></div></div><script>
          if (!window.history.state || !window.history.state.key) {
            window.history.replaceState({ key: Math.random().toString(32).slice(2) }, null);
          }
          let STORAGE_KEY = "positions";
          try {
            let positions = JSON.parse(sessionStorage.getItem("positions") ?? '{}')
            let storedY = positions[window.history.state.key];
            if (typeof storedY === 'number') {
              window.scrollTo(0, storedY)
            }
          } catch(error) {
            console.error(error)
            sessionStorage.removeItem(STORAGE_KEY)
          }
        </script><link rel="modulepreload" href="../../../../build/_shared/chunk-N3KPM2EV.js"/><link rel="modulepreload" href="../../../../build/_shared/chunk-YTGA4KPU.js"/><link rel="modulepreload" href="../../../../build/root-63J2OI5O.js"/><link rel="modulepreload" href="../../../../build/_shared/chunk-GWT4HVMK.js"/><link rel="modulepreload" href="../../../../build/_shared/chunk-WV7HFGSM.js"/><link rel="modulepreload" href="../../../../build/_shared/chunk-43DMIVRF.js"/><link rel="modulepreload" href="../../../../build/_shared/chunk-AYAFUZYC.js"/><link rel="modulepreload" href="../../../../build/routes/docs/$lang.$version-WDGSSTHQ.js"/><link rel="modulepreload" href="../../../../build/_shared/chunk-CXMLCDHV.js"/><link rel="modulepreload" href="../../../../build/_shared/chunk-TEGZ72RU.js"/><link rel="modulepreload" href="../../../../build/routes/docs/$lang.$version/$-XTVJBAXD.js"/><script>window.__remixContext = {'matches':[{'params':{'lang':'en','version':'v1.0.4','*':'other-api/constraints'},'pathname':'/','route':{'id':'root','path':'','module':'/build/root-63J2OI5O.js','hasAction':false,'hasLoader':true,'hasCatchBoundary':true,'hasErrorBoundary':true}},{'params':{'lang':'en','version':'v1.0.4','*':'other-api/constraints'},'pathname':'/docs/en/v1.0.4','route':{'id':'routes/docs/$lang.$version','parentId':'root','path':'docs/:lang/:version','module':'/build/routes/docs/$lang.$version-WDGSSTHQ.js','imports':['/build/_shared/chunk-GWT4HVMK.js','/build/_shared/chunk-WV7HFGSM.js','/build/_shared/chunk-43DMIVRF.js','/build/_shared/chunk-AYAFUZYC.js'],'hasAction':false,'hasLoader':true,'hasCatchBoundary':false,'hasErrorBoundary':false}},{'params':{'lang':'en','version':'v1.0.4','*':'other-api/constraints'},'pathname':'/docs/en/v1.0.4/other-api/constraints','route':{'id':'routes/docs/$lang.$version/$','parentId':'routes/docs/$lang.$version','path':'*','module':'/build/routes/docs/$lang.$version/$-XTVJBAXD.js','imports':['/build/_shared/chunk-CXMLCDHV.js','/build/_shared/chunk-TEGZ72RU.js'],'hasAction':false,'hasLoader':true,'hasCatchBoundary':false,'hasErrorBoundary':false}}],'componentDidCatchEmulator':{'trackBoundaries':true,'trackCatchBoundaries':true,'catchBoundaryRouteId':'root','renderBoundaryRouteId':null,'loaderBoundaryRouteId':'root','error':undefined,'catch':undefined},'routeData':{'root':{'noIndex':false},'routes/docs/$lang.$version':[{'slug':'/api','title':'API','hasContent':false,'order':3,'disabled':false,'children':[{'slug':'/api/conventions','title':'Conventions','hasContent':true,'order':1,'disabled':false,'children':[]},{'slug':'/api/remix','title':'Remix Package','hasContent':true,'order':2,'disabled':false,'children':[]}]},{'slug':'/contributing','title':'Contributing','hasContent':true,'order':6,'disabled':false,'children':[]},{'slug':'/guides','title':'Guides','hasContent':false,'order':5,'disabled':false,'children':[{'slug':'/guides/accessibility','title':'Accessibility','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/api-routes','title':'API Routes','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/data-writes','title':'Data Writes','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/disabling-javascript','title':'Disabling JavaScript','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/envvars','title':'Environment Variables','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/errors','title':'Error Handling','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/mdx','title':'MDX','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/not-found','title':'Not Found Handling','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/optimistic-ui','title':'Optimistic UI','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/performance','title':'Performance','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/philosophy','title':'Philosophy','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/resource-routes','title':'Resource Routes','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/routing','title':'Routing','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/guides/styling','title':'Styling','hasContent':true,'order':null,'disabled':false,'children':[]}]},{'slug':'/other-api','title':'Other API','hasContent':false,'order':4,'disabled':false,'children':[{'slug':'/other-api/adapter','title':'@remix-run/{adapter}','hasContent':true,'order':2,'disabled':false,'children':[]},{'slug':'/other-api/constraints','title':'Module Constraints','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/other-api/dev','title':'@remix-run/dev (CLI)','hasContent':true,'order':1,'disabled':false,'children':[]},{'slug':'/other-api/fetch','title':'Web Fetch API','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/other-api/node','title':'@remix-run/node','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/other-api/react-router','title':'React Router v6','hasContent':true,'order':null,'disabled':false,'children':[]},{'slug':'/other-api/serve','title':'@remix-run/serve','hasContent':true,'order':null,'disabled':false,'children':[]}]},{'slug':'/tutorials','title':'Tutorials','hasContent':false,'order':2,'disabled':false,'children':[{'slug':'/tutorials/blog','title':'Developer Blog','hasContent':true,'order':1,'disabled':false,'children':[]},{'slug':'/tutorials/jokes','title':'Jokes App','hasContent':true,'order':2,'disabled':false,'children':[]}]}],'routes/docs/$lang.$version/$':{'id':'ckwdu8xxz0443f0ezfemzlow2','filePath':'/other-api/constraints.md','md':'\n# Module Constraints\n\nIn order for Remix to run your app in both the server and browser environments, your application modules and third party dependencies need to be careful about **module side effects**.\n\n- **Server-only code** - Remix will remove server-only code but it can\'t if you have module side effects that use server-only code.\n- **Browser-only code** - Remix renders on the server so your modules can\'t have module side effects or first-rendering logic that call browser-only APIs\n\n## Server Code Pruning\n\nThe Remix compiler will automatically remove server code from the browser bundles. Our strategy is actually pretty straightforward, but requires you to follow some rules.\n\n1. It creates a "proxy" module in front of your route module\n2. The proxy module only imports the browser specific exports\n\nConsider a route module that exports `loader`, `meta`, and a component:\n\n```tsx\nimport { useLoaderData } from "remix";\nimport PostsView from "../PostsView";\nimport { prisma } from "../db";\n\nexport function loader() {\n  return prisma.post.findMany();\n}\n\nexport function meta() {\n  return { title: "Posts" };\n}\n\nexport default function Posts() {\n  let posts = useLoaderData();\n  return <PostsView posts={posts} />;\n}\n```\n\nThe server needs everything in this file but the browser only needs the component and `meta`. In fact, it\'ll be completely broken if it includes the `prisma` module in the browser bundle. That thing is full of node-only APIs!\n\nTo remove the server code from the browser bundles, the Remix compiler creates a proxy module in front of your route and bundles that instead. The proxy for this route would look like:\n\n```ts\nexport { meta, default } from "./routes/posts.tsx";\n```\n\nThe compiler will now analyze the code in `routes/posts.tsx` and only keep code that\'s inside of `meta` and the component. The result is something like this:\n\n```tsx\nimport { useLoaderData } from "remix";\nimport PostsView from "../PostsView";\n\nexport function meta() {\n  return { title: "Posts" };\n}\n\nexport default function Posts() {\n  let posts = useLoaderData();\n  return <PostsView posts={posts} />;\n}\n```\n\nPretty slick! This is now safe to bundle up for the browser. So what\'s the problem?\n\n### No Module Side Effects\n\nIf you\'re unfamiliar with side effects, you\'re not alone! We\'ll help you identify them now.\n\nSimply put, a **side effect** is any code that might _do something_. A **module side effect** is any code that might _do something when a module is loaded_.\n\n<docs-info>A module side effect is code that executes by simply importing a module</docs-info>\n\nTaking our code from earlier, we saw how the compiler can remove the exports and their imports that aren\'t used. But if we add this seemingly harmless line of code your app will break!\n\n```tsx bad lines=5\nimport { useLoaderData } from "remix";\nimport PostsView from "../PostsView";\nimport { prisma } from "../db";\n\nconsole.log(prisma);\n\nexport function loader() {\n  return prisma.post.findMany();\n}\n\nexport function meta() {\n  return { title: "Posts" };\n}\n\nexport default function Posts() {\n  let posts = useLoaderData();\n  return <PostsView posts={posts} />;\n}\n```\n\nThat `console.log` _does something_. The module is imported and then immediately logs to the console. The compiler won\'t remove it because it has to run when the module is imported. It will bundle something like this:\n\n```tsx bad lines=3,5\nimport { useLoaderData } from "remix";\nimport PostsView from "../PostsView";\nimport { prisma } from "../db"; //\uD83D\uDE2C\n\nconsole.log(prisma); //\uD83E\uDD76\n\nexport function meta() {\n  return { title: "Posts" };\n}\n\nexport default function Posts() {\n  let posts = useLoaderData();\n  return <PostsView posts={posts} />;\n}\n```\n\nThe loader is gone but the prisma dependency stayed! Had we logged something harmless like `console.log("hello!")` it would be fine. But we logged the `prisma` module so the browser\'s gonna have a hard time with that.\n\nTo fix this, remove the side effect by simply moving the code _into the loader_.\n\n```tsx [6]\nimport { useLoaderData } from "remix";\nimport PostsView from "../PostsView";\nimport { prisma } from "../db";\n\nexport function loader() {\n  console.log(prisma);\n  return prisma.post.findMany();\n}\n\nexport function meta() {\n  return { title: "Posts" };\n}\n\nexport default function Posts() {\n  let posts = useLoaderData();\n  return <PostsView posts={posts} />;\n}\n```\n\nThis is no longer a module side effect (runs when the module is imported), but rather a side effect of the loader (runs when the loader is called). The compiler will now remove both the loader _and the prisma import_ because it isn\'t used anywhere else in the module.\n\n### Higher Order Functions\n\nSome Remix newcomers try to abstract their loaders with "higher order functions". Something like this:\n\n```js bad filename=app/http.js\nimport { redirect } from "remix";\n\nexport function removeTrailingSlash(loader) {\n  return function (arg) {\n    let { request } = arg;\n    let url = new URL(request.url);\n    if (url.pathname.endsWith("/")) {\n      return redirect(request.url.slice(0, -1), {\n        status: 308\n      });\n    }\n    return loader(arg);\n  };\n}\n```\n\nAnd then try to use it like this:\n\n```js bad filename=app/root.js\nimport { removeTrailingSlash } from "~/http";\n\nexport let loader = removeTrailingSlash(({ request }) => {\n  return { some: "data" };\n});\n```\n\nYou can probably now see that this is a module side effect so the compiler can\'t prune out the `removeTrailingSlash` code.\n\nThis type of abstraction is introduced to try to return a response early. Since you can throw a Response in a loader, we can make this simpler and remove the module side effect at the same time so that the server code can be pruned:\n\n```js filename=app/http.js\nimport { redirect } from "remix";\n\nexport function removeTrailingSlash(url) {\n  if (url.pathname.endsWith("/")) {\n    throw redirect(request.url.slice(0, -1), {\n      status: 308\n    });\n  }\n}\n```\n\nAnd then use it like this:\n\n```js bad filename=app/root.js\nimport { removeTrailingSlash } from "~/http";\n\nexport let loader = ({ request }) => {\n  removeTrailingSlash(request.url);\n  return { some: "data" };\n};\n```\n\nIt reads much nicer as well when you\'ve got a lot of these:\n\n```ts\n// this\nexport let loader = ({ request }) => {\n  return removeTrailingSlash(request.url, () => {\n    return withSession(request, session => {\n      return requireUser(session, user => {\n        return json(user);\n      });\n    });\n  });\n};\n\n// vs. this\nexport let loader = ({ request }) => {\n  removeTrailingSlash(request.url);\n  let session = await getSession(request);\n  let user = await requireUser(session);\n  return json(user);\n};\n```\n\nIf you want to do some extra-curricular reading, google around for "push vs. pull API". The ability to throw responses changes the model from a "push" to a "pull". This is the same reason folks prefer async/await over callbacks, and React hooks over higher order components and render props.\n\n## Browser-Only Code on the Server\n\nUnlike the browser bundles, Remix doesn\'t try to remove _browser only code_ from the server bundle because the route modules require every export to render on the server. This means it\'s your job to be mindful of code that should only execute in the browser.\n\n<docs-error>This will break your app:</docs-error>\n\n```js bad lines=3\nimport { loadStripe } from "@stripe/stripe-js";\n\nlet stripe = await loadStripe(window.ENV.stripe);\n\nexport async function redirectToStripeCheckout(sessionId) {\n  return stripe.redirectToCheckout({ sessionId });\n}\n```\n\n<docs-info>You need to avoid any browser-only module side effects like accessing window or initializing APIs in the module scope.</docs-info>\n\n### Initializing Browser Only APIs\n\nThe most common scenario is intitializing a third party API when your module is imported. There are a couple ways to easily deal with this.\n\n#### Window Guard\n\nThis ensures the library is only initialized if there is a `window`, meaning you\'re in the browser.\n\n```js [3]\nimport firebase from "firebase/app";\n\nif (typeof window !== "undefined") {\n  firebase.initializeApp(window.ENV.firebase);\n}\n\nexport { firebase };\n```\n\n#### Lazy Initialization\n\nThis strategy defers initialization until the library is actually used:\n\n```js [4]\nimport { loadStripe } from "@stripe/stripe-js";\n\nexport async function redirectToStripeCheckout(sessionId) {\n  let stripe = await loadStripe(window.ENV.stripe);\n  return stripe.redirectToCheckout({ sessionId });\n}\n```\n\nYou may want to avoid initializing the library multiple times by storing it in a module-scoped variable.\n\n```js\nimport { loadStripe } from "@stripe/stripe-js";\n\nlet _stripe;\nasync function getStripe() {\n  if (!_stripe) {\n    _stripe = await loadStripe(window.ENV.stripe);\n  }\n  return _stripe;\n}\n\nexport async function redirectToStripeCheckout(sessionId) {\n  let stripe = await getStripe();\n  return stripe.redirectToCheckout({ sessionId });\n}\n```\n\n<docs-info>While none of these strategies remove browser modules from the server bundle, it\'s okay because the APIs are only called inside of event handlers and effects, which are not module side effects.</docs-info>\n\n### Rendering with Browser Only APIs\n\nAnother common case is code that calls browser-only APIs while rendering. When server rendering in React (not just Remix), this must be avoided because the APIs don\'t exist on the server.\n\n<docs-error>This will break your app because the server will try to use local storage</docs-error>\n\n```js bad lines=2\nfunction useLocalStorage(key) {\n  let [state, setState] = useState(\n    localStorage.getItem(key)\n  );\n\n  let setWithLocalStorage = nextState => {\n    setState(nextState);\n  };\n\n  return [state, setWithLocalStorage];\n}\n```\n\nYou can fix this by moving the code into `useEffect`, which only runs in the browser.\n\n```js [2,4-6]\nfunction useLocalStorage(key) {\n  let [state, setState] = useState(null);\n\n  useEffect(() => {\n    setState(localStorage.getItem(key));\n  }, []);\n\n  let setWithLocalStorage = nextState => {\n    setState(nextState);\n  };\n\n  return [state, setWithLocalStorage];\n}\n```\n\nNow `localStorage` is not being accessed on the initial render, which will work for the server. In the browser, that state will fill in immediately after hydration. Hopefully it doesn\'t cause a big content layout shift though! If it does, maybe move that state into your database or a cookie so you can access it server side.\n\n### `useLayoutEffect`\n\nIf you use this hook React will warn you about using it on the server.\n\nThis hook is great when you\'re setting state for things like:\n\n- The position of an element when it pops up (like a menu button)\n- The scroll position in response to user interactions\n\nThe point is to perform the effect at the same time as the browser paint so that you don\'t see the popup show up at `0,0` and then bounce into place. Layout effects let the paint and the effect happen at the same time to avoid this kind of flashing.\n\nIt is **not** good for setting state that is rendered inside of elements. Just make sure you aren\'t using the state set in a `useLayoutEffect` in your elements and you can ignore React\'s warning.\n\nTODO: Link to Reach UI `useIsomorphicLayoutEffect`\n\n### Third-Party Module Side Effects\n\nSome third party libraries have their own module side effects that are incompatible with React server rendering. Usually it\'s trying to access `window` for feature detection.\n\nThese libraries are incompatible with server rendering in React and therefore incompatible with Remix. Fortunately, very few third party libraries in the React ecosystem do this.\n\nWe recommend finding an alternative. But if you can\'t, we recommend using [patch-package](https://www.npmjs.com/package/patch-package) to fix it up in your app.\n','html':'<div class="md-toc-container"><div class="md-toc-nav" role="navigation"><ul class="toc">\n<li>\n<p><a href="constraints.html#module-constraints">Module Constraints</a></p>\n<ul>\n<li>\n<p><a href="constraints.html#server-code-pruning">Server Code Pruning</a></p>\n<ul>\n<li><a href="constraints.html#no-module-side-effects">No Module Side Effects</a></li>\n<li><a href="constraints.html#higher-order-functions">Higher Order Functions</a></li>\n</ul>\n</li>\n<li>\n<p><a href="constraints.html#browser-only-code-on-the-server">Browser-Only Code on the Server</a></p>\n<ul>\n<li>\n<p><a href="constraints.html#initializing-browser-only-apis">Initializing Browser Only APIs</a></p>\n<ul>\n<li><a href="constraints.html#window-guard">Window Guard</a></li>\n<li><a href="constraints.html#lazy-initialization">Lazy Initialization</a></li>\n</ul>\n</li>\n<li>\n<p><a href="constraints.html#rendering-with-browser-only-apis">Rendering with Browser Only APIs</a></p>\n</li>\n<li>\n<p><a href="constraints.html#uselayouteffect"><code>useLayoutEffect</code></a></p>\n</li>\n<li>\n<p><a href="constraints.html#third-party-module-side-effects">Third-Party Module Side Effects</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul></div><div class="md-prose"><h1 id="module-constraints"><a href="constraints.html#module-constraints" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Module Constraints</h1><p>In order for Remix to run your app in both the server and browser environments, your application modules and third party dependencies need to be careful about <strong>module side effects</strong>.</p><ul>\n<li><strong>Server-only code</strong> - Remix will remove server-only code but it can\'t if you have module side effects that use server-only code.</li>\n<li><strong>Browser-only code</strong> - Remix renders on the server so your modules can\'t have module side effects or first-rendering logic that call browser-only APIs</li>\n</ul><h2 id="server-code-pruning"><a href="constraints.html#server-code-pruning" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Server Code Pruning</h2><p>The Remix compiler will automatically remove server code from the browser bundles. Our strategy is actually pretty straightforward, but requires you to follow some rules.</p><ol>\n<li>It creates a "proxy" module in front of your route module</li>\n<li>The proxy module only imports the browser specific exports</li>\n</ol><p>Consider a route module that exports <code>loader</code>, <code>meta</code>, and a component:</p><div><pre data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";\n</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">prisma</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../db</span>";\n</span><span class="codeblock-line" data-line-number="4">\n</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">loader</span>() {\n</span><span class="codeblock-line" data-line-number="6">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">prisma</span>.<span style="color: var(--base0D)">post</span>.<span style="color: var(--base0D)">findMany</span>();\n</span><span class="codeblock-line" data-line-number="7">}\n</span><span class="codeblock-line" data-line-number="8">\n</span><span class="codeblock-line" data-line-number="9"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {\n</span><span class="codeblock-line" data-line-number="10">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };\n</span><span class="codeblock-line" data-line-number="11">}\n</span><span class="codeblock-line" data-line-number="12">\n</span><span class="codeblock-line" data-line-number="13"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {\n</span><span class="codeblock-line" data-line-number="14">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();\n</span><span class="codeblock-line" data-line-number="15">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;\n</span><span class="codeblock-line" data-line-number="16">}\n</span></code></pre></div><p>The server needs everything in this file but the browser only needs the component and <code>meta</code>. In fact, it\'ll be completely broken if it includes the <code>prisma</code> module in the browser bundle. That thing is full of node-only APIs!</p><p>To remove the server code from the browser bundles, the Remix compiler creates a proxy module in front of your route and bundles that instead. The proxy for this route would look like:</p><div><pre data-line-numbers="true" data-lang="ts" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">export</span> { <span style="color: var(--base08)">meta</span>, <span style="color: var(--base0E)">default</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">./routes/posts.tsx</span>";\n</span></code></pre></div><p>The compiler will now analyze the code in <code>routes/posts.tsx</code> and only keep code that\'s inside of <code>meta</code> and the component. The result is something like this:</p><div><pre data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";\n</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";\n</span><span class="codeblock-line" data-line-number="3">\n</span><span class="codeblock-line" data-line-number="4"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {\n</span><span class="codeblock-line" data-line-number="5">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };\n</span><span class="codeblock-line" data-line-number="6">}\n</span><span class="codeblock-line" data-line-number="7">\n</span><span class="codeblock-line" data-line-number="8"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {\n</span><span class="codeblock-line" data-line-number="9">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();\n</span><span class="codeblock-line" data-line-number="10">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;\n</span><span class="codeblock-line" data-line-number="11">}\n</span></code></pre></div><p>Pretty slick! This is now safe to bundle up for the browser. So what\'s the problem?</p><h3 id="no-module-side-effects"><a href="constraints.html#no-module-side-effects" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>No Module Side Effects</h3><p>If you\'re unfamiliar with side effects, you\'re not alone! We\'ll help you identify them now.</p><p>Simply put, a <strong>side effect</strong> is any code that might <em>do something</em>. A <strong>module side effect</strong> is any code that might <em>do something when a module is loaded</em>.</p><p><docs-info>A module side effect is code that executes by simply importing a module</docs-info></p><p>Taking our code from earlier, we saw how the compiler can remove the exports and their imports that aren\'t used. But if we add this seemingly harmless line of code your app will break!</p><div><pre data-bad="" data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";\n</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">prisma</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../db</span>";\n</span><span class="codeblock-line" data-line-number="4">\n</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base08)">console</span>.<span style="color: var(--base0D)">log</span>(<span style="color: var(--base08)">prisma</span>);\n</span><span class="codeblock-line" data-line-number="6">\n</span><span class="codeblock-line" data-line-number="7"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">loader</span>() {\n</span><span class="codeblock-line" data-line-number="8">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">prisma</span>.<span style="color: var(--base0D)">post</span>.<span style="color: var(--base0D)">findMany</span>();\n</span><span class="codeblock-line" data-line-number="9">}\n</span><span class="codeblock-line" data-line-number="10">\n</span><span class="codeblock-line" data-line-number="11"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {\n</span><span class="codeblock-line" data-line-number="12">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };\n</span><span class="codeblock-line" data-line-number="13">}\n</span><span class="codeblock-line" data-line-number="14">\n</span><span class="codeblock-line" data-line-number="15"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {\n</span><span class="codeblock-line" data-line-number="16">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();\n</span><span class="codeblock-line" data-line-number="17">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;\n</span><span class="codeblock-line" data-line-number="18">}\n</span></code></pre></div><p>That <code>console.log</code> <em>does something</em>. The module is imported and then immediately logs to the console. The compiler won\'t remove it because it has to run when the module is imported. It will bundle something like this:</p><div><pre data-bad="" data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";\n</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">prisma</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../db</span>"; <span style="color: var(--base03)">//\uD83D\uDE2C</span>\n</span><span class="codeblock-line" data-line-number="4">\n</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base08)">console</span>.<span style="color: var(--base0D)">log</span>(<span style="color: var(--base08)">prisma</span>); <span style="color: var(--base03)">//\uD83E\uDD76</span>\n</span><span class="codeblock-line" data-line-number="6">\n</span><span class="codeblock-line" data-line-number="7"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {\n</span><span class="codeblock-line" data-line-number="8">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };\n</span><span class="codeblock-line" data-line-number="9">}\n</span><span class="codeblock-line" data-line-number="10">\n</span><span class="codeblock-line" data-line-number="11"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {\n</span><span class="codeblock-line" data-line-number="12">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();\n</span><span class="codeblock-line" data-line-number="13">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;\n</span><span class="codeblock-line" data-line-number="14">}\n</span></code></pre></div><p>The loader is gone but the prisma dependency stayed! Had we logged something harmless like <code>console.log("hello!")</code> it would be fine. But we logged the <code>prisma</code> module so the browser\'s gonna have a hard time with that.</p><p>To fix this, remove the side effect by simply moving the code <em>into the loader</em>.</p><div><pre data-line-numbers="true" data-lang="tsx" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">useLoaderData</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";\n</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">PostsView</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../PostsView</span>";\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">prisma</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">../db</span>";\n</span><span class="codeblock-line" data-line-number="4">\n</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">loader</span>() {\n</span><span class="codeblock-line" data-highlight="true" data-line-number="6">  <span style="color: var(--base08)">console</span>.<span style="color: var(--base0D)">log</span>(<span style="color: var(--base08)">prisma</span>);\n</span><span class="codeblock-line" data-line-number="7">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">prisma</span>.<span style="color: var(--base0D)">post</span>.<span style="color: var(--base0D)">findMany</span>();\n</span><span class="codeblock-line" data-line-number="8">}\n</span><span class="codeblock-line" data-line-number="9">\n</span><span class="codeblock-line" data-line-number="10"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">meta</span>() {\n</span><span class="codeblock-line" data-line-number="11">  <span style="color: var(--base0E)">return</span> { title: "<span style="color: var(--base0B)">Posts</span>" };\n</span><span class="codeblock-line" data-line-number="12">}\n</span><span class="codeblock-line" data-line-number="13">\n</span><span class="codeblock-line" data-line-number="14"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">default</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">Posts</span>() {\n</span><span class="codeblock-line" data-line-number="15">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">posts</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useLoaderData</span>();\n</span><span class="codeblock-line" data-line-number="16">  <span style="color: var(--base0E)">return</span> &#x3C;<span style="color: var(--base0A)">PostsView</span> <span style="color: var(--base0D)">posts</span><span style="color: var(--base0E)">=</span><span style="color: var(--base0F)">{</span><span style="color: var(--base08)">posts</span><span style="color: var(--base0F)">}</span> />;\n</span><span class="codeblock-line" data-line-number="17">}\n</span></code></pre></div><p>This is no longer a module side effect (runs when the module is imported), but rather a side effect of the loader (runs when the loader is called). The compiler will now remove both the loader <em>and the prisma import</em> because it isn\'t used anywhere else in the module.</p><h3 id="higher-order-functions"><a href="constraints.html#higher-order-functions" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Higher Order Functions</h3><p>Some Remix newcomers try to abstract their loaders with "higher order functions". Something like this:</p><div><pre data-bad="" data-filename="app/http.js" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">redirect</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";\n</span><span class="codeblock-line" data-line-number="2">\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">loader</span>) {\n</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">function</span> (<span style="color: var(--base08)">arg</span>) {\n</span><span class="codeblock-line" data-line-number="5">    <span style="color: var(--base0A)">let</span> { <span style="color: var(--base08)">request</span> } <span style="color: var(--base0E)">=</span> <span style="color: var(--base08)">arg</span>;\n</span><span class="codeblock-line" data-line-number="6">    <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">url</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">new</span> <span style="color: var(--base0D)">URL</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base08)">url</span>);\n</span><span class="codeblock-line" data-line-number="7">    <span style="color: var(--base0E)">if</span> (<span style="color: var(--base08)">url</span>.<span style="color: var(--base0D)">pathname</span>.<span style="color: var(--base0D)">endsWith</span>("<span style="color: var(--base0B)">/</span>")) {\n</span><span class="codeblock-line" data-line-number="8">      <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">redirect</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base0D)">url</span>.<span style="color: var(--base0D)">slice</span>(<span style="color: var(--base09)">0</span>, <span style="color: var(--base0E)">-</span><span style="color: var(--base09)">1</span>), {\n</span><span class="codeblock-line" data-line-number="9">        status: <span style="color: var(--base09)">308</span>\n</span><span class="codeblock-line" data-line-number="10">      });\n</span><span class="codeblock-line" data-line-number="11">    }\n</span><span class="codeblock-line" data-line-number="12">    <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">loader</span>(<span style="color: var(--base08)">arg</span>);\n</span><span class="codeblock-line" data-line-number="13">  };\n</span><span class="codeblock-line" data-line-number="14">}\n</span></code></pre></div><p>And then try to use it like this:</p><div><pre data-bad="" data-filename="app/root.js" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">removeTrailingSlash</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">~/http</span>";\n</span><span class="codeblock-line" data-line-number="2">\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">loader</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">removeTrailingSlash</span>(({ <span style="color: var(--base08)">request</span> }) <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base0E)">return</span> { some: "<span style="color: var(--base0B)">data</span>" };\n</span><span class="codeblock-line" data-line-number="5">});\n</span></code></pre></div><p>You can probably now see that this is a module side effect so the compiler can\'t prune out the <code>removeTrailingSlash</code> code.</p><p>This type of abstraction is introduced to try to return a response early. Since you can throw a Response in a loader, we can make this simpler and remove the module side effect at the same time so that the server code can be pruned:</p><div><pre data-filename="app/http.js" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">redirect</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">remix</span>";\n</span><span class="codeblock-line" data-line-number="2">\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">url</span>) {\n</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base0E)">if</span> (<span style="color: var(--base08)">url</span>.<span style="color: var(--base0D)">pathname</span>.<span style="color: var(--base0D)">endsWith</span>("<span style="color: var(--base0B)">/</span>")) {\n</span><span class="codeblock-line" data-line-number="5">    <span style="color: var(--base0E)">throw</span> <span style="color: var(--base0D)">redirect</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base0D)">url</span>.<span style="color: var(--base0D)">slice</span>(<span style="color: var(--base09)">0</span>, <span style="color: var(--base0E)">-</span><span style="color: var(--base09)">1</span>), {\n</span><span class="codeblock-line" data-line-number="6">      status: <span style="color: var(--base09)">308</span>\n</span><span class="codeblock-line" data-line-number="7">    });\n</span><span class="codeblock-line" data-line-number="8">  }\n</span><span class="codeblock-line" data-line-number="9">}\n</span></code></pre></div><p>And then use it like this:</p><div><pre data-bad="" data-filename="app/root.js" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">removeTrailingSlash</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">~/http</span>";\n</span><span class="codeblock-line" data-line-number="2">\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0A)">let</span> <span style="color: var(--base0D)">loader</span> <span style="color: var(--base0E)">=</span> ({ <span style="color: var(--base08)">request</span> }) <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base08)">url</span>);\n</span><span class="codeblock-line" data-line-number="5">  <span style="color: var(--base0E)">return</span> { some: "<span style="color: var(--base0B)">data</span>" };\n</span><span class="codeblock-line" data-line-number="6">};\n</span></code></pre></div><p>It reads much nicer as well when you\'ve got a lot of these:</p><div><pre data-line-numbers="true" data-lang="ts" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base03)">// this</span>\n</span><span class="codeblock-line" data-line-number="2"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">let</span> <span style="color: var(--base0D)">loader</span> <span style="color: var(--base0E)">=</span> ({ <span style="color: var(--base08)">request</span> }) <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-line-number="3">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base08)">url</span>, () <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-line-number="4">    <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">withSession</span>(<span style="color: var(--base08)">request</span>, <span style="color: var(--base08)">session</span> <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-line-number="5">      <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">requireUser</span>(<span style="color: var(--base08)">session</span>, <span style="color: var(--base08)">user</span> <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-line-number="6">        <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">json</span>(<span style="color: var(--base08)">user</span>);\n</span><span class="codeblock-line" data-line-number="7">      });\n</span><span class="codeblock-line" data-line-number="8">    });\n</span><span class="codeblock-line" data-line-number="9">  });\n</span><span class="codeblock-line" data-line-number="10">};\n</span><span class="codeblock-line" data-line-number="11">\n</span><span class="codeblock-line" data-line-number="12"><span style="color: var(--base03)">// vs. this</span>\n</span><span class="codeblock-line" data-line-number="13"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">let</span> <span style="color: var(--base0D)">loader</span> <span style="color: var(--base0E)">=</span> ({ <span style="color: var(--base08)">request</span> }) <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-line-number="14">  <span style="color: var(--base0D)">removeTrailingSlash</span>(<span style="color: var(--base08)">request</span>.<span style="color: var(--base08)">url</span>);\n</span><span class="codeblock-line" data-line-number="15">  <span style="color: var(--base0E)">let</span> <span style="color: var(--base08)">session</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">getSession</span>(<span style="color: var(--base08)">request</span>);\n</span><span class="codeblock-line" data-line-number="16">  <span style="color: var(--base0E)">let</span> <span style="color: var(--base08)">user</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">requireUser</span>(<span style="color: var(--base08)">session</span>);\n</span><span class="codeblock-line" data-line-number="17">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base0D)">json</span>(<span style="color: var(--base08)">user</span>);\n</span><span class="codeblock-line" data-line-number="18">};\n</span></code></pre></div><p>If you want to do some extra-curricular reading, google around for "push vs. pull API". The ability to throw responses changes the model from a "push" to a "pull". This is the same reason folks prefer async/await over callbacks, and React hooks over higher order components and render props.</p><h2 id="browser-only-code-on-the-server"><a href="constraints.html#browser-only-code-on-the-server" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Browser-Only Code on the Server</h2><p>Unlike the browser bundles, Remix doesn\'t try to remove <em>browser only code</em> from the server bundle because the route modules require every export to render on the server. This means it\'s your job to be mindful of code that should only execute in the browser.</p><p><docs-error>This will break your app:</docs-error></p><div><pre data-bad="" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">loadStripe</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">@stripe/stripe-js</span>";\n</span><span class="codeblock-line" data-line-number="2">\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">stripe</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">loadStripe</span>(<span style="color: var(--base08)">window</span>.<span style="color: var(--base08)">ENV</span>.<span style="color: var(--base08)">stripe</span>);\n</span><span class="codeblock-line" data-line-number="4">\n</span><span class="codeblock-line" data-line-number="5"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">async</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">redirectToStripeCheckout</span>(<span style="color: var(--base08)">sessionId</span>) {\n</span><span class="codeblock-line" data-line-number="6">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">stripe</span>.<span style="color: var(--base0D)">redirectToCheckout</span>({ <span style="color: var(--base08)">sessionId</span> });\n</span><span class="codeblock-line" data-line-number="7">}\n</span></code></pre></div><p><docs-info>You need to avoid any browser-only module side effects like accessing window or initializing APIs in the module scope.</docs-info></p><h3 id="initializing-browser-only-apis"><a href="constraints.html#initializing-browser-only-apis" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Initializing Browser Only APIs</h3><p>The most common scenario is intitializing a third party API when your module is imported. There are a couple ways to easily deal with this.</p><h4 id="window-guard"><a href="constraints.html#window-guard" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Window Guard</h4><p>This ensures the library is only initialized if there is a <code>window</code>, meaning you\'re in the browser.</p><div><pre data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> <span style="color: var(--base08)">firebase</span> <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">firebase/app</span>";\n</span><span class="codeblock-line" data-line-number="2">\n</span><span class="codeblock-line" data-highlight="true" data-line-number="3"><span style="color: var(--base0E)">if</span> (<span style="color: var(--base0E)">typeof</span> <span style="color: var(--base08)">window</span> <span style="color: var(--base0E)">!==</span> "<span style="color: var(--base0B)">undefined</span>") {\n</span><span class="codeblock-line" data-line-number="4">  <span style="color: var(--base08)">firebase</span>.<span style="color: var(--base0D)">initializeApp</span>(<span style="color: var(--base08)">window</span>.<span style="color: var(--base08)">ENV</span>.<span style="color: var(--base08)">firebase</span>);\n</span><span class="codeblock-line" data-line-number="5">}\n</span><span class="codeblock-line" data-line-number="6">\n</span><span class="codeblock-line" data-line-number="7"><span style="color: var(--base0E)">export</span> { <span style="color: var(--base08)">firebase</span> };\n</span></code></pre></div><h4 id="lazy-initialization"><a href="constraints.html#lazy-initialization" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Lazy Initialization</h4><p>This strategy defers initialization until the library is actually used:</p><div><pre data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">loadStripe</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">@stripe/stripe-js</span>";\n</span><span class="codeblock-line" data-line-number="2">\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">async</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">redirectToStripeCheckout</span>(<span style="color: var(--base08)">sessionId</span>) {\n</span><span class="codeblock-line" data-highlight="true" data-line-number="4">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">stripe</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">loadStripe</span>(<span style="color: var(--base08)">window</span>.<span style="color: var(--base08)">ENV</span>.<span style="color: var(--base08)">stripe</span>);\n</span><span class="codeblock-line" data-line-number="5">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">stripe</span>.<span style="color: var(--base0D)">redirectToCheckout</span>({ <span style="color: var(--base08)">sessionId</span> });\n</span><span class="codeblock-line" data-line-number="6">}\n</span></code></pre></div><p>You may want to avoid initializing the library multiple times by storing it in a module-scoped variable.</p><div><pre data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0E)">import</span> { <span style="color: var(--base08)">loadStripe</span> } <span style="color: var(--base0E)">from</span> "<span style="color: var(--base0B)">@stripe/stripe-js</span>";\n</span><span class="codeblock-line" data-line-number="2">\n</span><span class="codeblock-line" data-line-number="3"><span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">_stripe</span>;\n</span><span class="codeblock-line" data-line-number="4"><span style="color: var(--base0E)">async</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">getStripe</span>() {\n</span><span class="codeblock-line" data-line-number="5">  <span style="color: var(--base0E)">if</span> (<span style="color: var(--base0E)">!</span><span style="color: var(--base08)">_stripe</span>) {\n</span><span class="codeblock-line" data-line-number="6">    <span style="color: var(--base08)">_stripe</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">loadStripe</span>(<span style="color: var(--base08)">window</span>.<span style="color: var(--base08)">ENV</span>.<span style="color: var(--base08)">stripe</span>);\n</span><span class="codeblock-line" data-line-number="7">  }\n</span><span class="codeblock-line" data-line-number="8">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">_stripe</span>;\n</span><span class="codeblock-line" data-line-number="9">}\n</span><span class="codeblock-line" data-line-number="10">\n</span><span class="codeblock-line" data-line-number="11"><span style="color: var(--base0E)">export</span> <span style="color: var(--base0E)">async</span> <span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">redirectToStripeCheckout</span>(<span style="color: var(--base08)">sessionId</span>) {\n</span><span class="codeblock-line" data-line-number="12">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base08)">stripe</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base0E)">await</span> <span style="color: var(--base0D)">getStripe</span>();\n</span><span class="codeblock-line" data-line-number="13">  <span style="color: var(--base0E)">return</span> <span style="color: var(--base08)">stripe</span>.<span style="color: var(--base0D)">redirectToCheckout</span>({ <span style="color: var(--base08)">sessionId</span> });\n</span><span class="codeblock-line" data-line-number="14">}\n</span></code></pre></div><p><docs-info>While none of these strategies remove browser modules from the server bundle, it\'s okay because the APIs are only called inside of event handlers and effects, which are not module side effects.</docs-info></p><h3 id="rendering-with-browser-only-apis"><a href="constraints.html#rendering-with-browser-only-apis" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Rendering with Browser Only APIs</h3><p>Another common case is code that calls browser-only APIs while rendering. When server rendering in React (not just Remix), this must be avoided because the APIs don\'t exist on the server.</p><p><docs-error>This will break your app because the server will try to use local storage</docs-error></p><div><pre data-bad="" data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">useLocalStorage</span>(<span style="color: var(--base08)">key</span>) {\n</span><span class="codeblock-line" data-line-number="2">  <span style="color: var(--base0A)">let</span> [<span style="color: var(--base08)">state</span>, <span style="color: var(--base08)">setState</span>] <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useState</span>(\n</span><span class="codeblock-line" data-line-number="3">    <span style="color: var(--base08)">localStorage</span>.<span style="color: var(--base0D)">getItem</span>(<span style="color: var(--base08)">key</span>)\n</span><span class="codeblock-line" data-line-number="4">  );\n</span><span class="codeblock-line" data-line-number="5">\n</span><span class="codeblock-line" data-line-number="6">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base0D)">setWithLocalStorage</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base08)">nextState</span> <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-line-number="7">    <span style="color: var(--base0D)">setState</span>(<span style="color: var(--base08)">nextState</span>);\n</span><span class="codeblock-line" data-line-number="8">  };\n</span><span class="codeblock-line" data-line-number="9">\n</span><span class="codeblock-line" data-line-number="10">  <span style="color: var(--base0E)">return</span> [<span style="color: var(--base08)">state</span>, <span style="color: var(--base08)">setWithLocalStorage</span>];\n</span><span class="codeblock-line" data-line-number="11">}\n</span></code></pre></div><p>You can fix this by moving the code into <code>useEffect</code>, which only runs in the browser.</p><div><pre data-line-numbers="true" data-lang="js" style="color: var(--base05);background-color: var(--base00)"><code><span class="codeblock-line" data-line-number="1"><span style="color: var(--base0D)">function</span> <span style="color: var(--base0D)">useLocalStorage</span>(<span style="color: var(--base08)">key</span>) {\n</span><span class="codeblock-line" data-highlight="true" data-line-number="2">  <span style="color: var(--base0A)">let</span> [<span style="color: var(--base08)">state</span>, <span style="color: var(--base08)">setState</span>] <span style="color: var(--base0E)">=</span> <span style="color: var(--base0D)">useState</span>(<span style="color: var(--base09)">null</span>);\n</span><span class="codeblock-line" data-line-number="3">\n</span><span class="codeblock-line" data-highlight="true" data-line-number="4">  <span style="color: var(--base0D)">useEffect</span>(() <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-highlight="true" data-line-number="5">    <span style="color: var(--base0D)">setState</span>(<span style="color: var(--base08)">localStorage</span>.<span style="color: var(--base0D)">getItem</span>(<span style="color: var(--base08)">key</span>));\n</span><span class="codeblock-line" data-highlight="true" data-line-number="6">  }, []);\n</span><span class="codeblock-line" data-line-number="7">\n</span><span class="codeblock-line" data-line-number="8">  <span style="color: var(--base0A)">let</span> <span style="color: var(--base0D)">setWithLocalStorage</span> <span style="color: var(--base0E)">=</span> <span style="color: var(--base08)">nextState</span> <span style="color: var(--base0D)">=></span> {\n</span><span class="codeblock-line" data-line-number="9">    <span style="color: var(--base0D)">setState</span>(<span style="color: var(--base08)">nextState</span>);\n</span><span class="codeblock-line" data-line-number="10">  };\n</span><span class="codeblock-line" data-line-number="11">\n</span><span class="codeblock-line" data-line-number="12">  <span style="color: var(--base0E)">return</span> [<span style="color: var(--base08)">state</span>, <span style="color: var(--base08)">setWithLocalStorage</span>];\n</span><span class="codeblock-line" data-line-number="13">}\n</span></code></pre></div><p>Now <code>localStorage</code> is not being accessed on the initial render, which will work for the server. In the browser, that state will fill in immediately after hydration. Hopefully it doesn\'t cause a big content layout shift though! If it does, maybe move that state into your database or a cookie so you can access it server side.</p><h3 id="uselayouteffect"><a href="constraints.html#uselayouteffect" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>useLayoutEffect</code></h3><p>If you use this hook React will warn you about using it on the server.</p><p>This hook is great when you\'re setting state for things like:</p><ul>\n<li>The position of an element when it pops up (like a menu button)</li>\n<li>The scroll position in response to user interactions</li>\n</ul><p>The point is to perform the effect at the same time as the browser paint so that you don\'t see the popup show up at <code>0,0</code> and then bounce into place. Layout effects let the paint and the effect happen at the same time to avoid this kind of flashing.</p><p>It is <strong>not</strong> good for setting state that is rendered inside of elements. Just make sure you aren\'t using the state set in a <code>useLayoutEffect</code> in your elements and you can ignore React\'s warning.</p><p>TODO: Link to Reach UI <code>useIsomorphicLayoutEffect</code></p><h3 id="third-party-module-side-effects"><a href="constraints.html#third-party-module-side-effects" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Third-Party Module Side Effects</h3><p>Some third party libraries have their own module side effects that are incompatible with React server rendering. Usually it\'s trying to access <code>window</code> for feature detection.</p><p>These libraries are incompatible with server rendering in React and therefore incompatible with Remix. Fortunately, very few third party libraries in the React ecosystem do this.</p><p>We recommend finding an alternative. But if you can\'t, we recommend using <a href="https://www.npmjs.com/package/patch-package">patch-package</a> to fix it up in your app.</p></div></div>\n','lang':'en','hasContent':true,'createdAt':'2021-11-24T18:06:22.679Z','updatedAt':'2021-11-24T18:06:22.679Z','title':'Module Constraints','order':null,'disabled':false,'siblingLinks':false,'published':null,'description':null,'hidden':false,'toc':true,'githubRefId':'refs/tags/v1.0.4'}},'actionData':undefined};</script><script src="../../../../build/manifest-10D43C8B.js"></script><script type="module">import * as route0 from "/build/root-63J2OI5O.js";
import * as route1 from "/build/routes/docs/$lang.$version-WDGSSTHQ.js";
import * as route2 from "/build/routes/docs/$lang.$version/$-XTVJBAXD.js";
window.__remixRouteModules = {"root":route0,"routes/docs/$lang.$version":route1,"routes/docs/$lang.$version/$":route2};</script><script src="../../../../build/entry.client-42KZW6ZZ.js" type="module"></script></body></html>